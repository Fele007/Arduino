#include "Matrix.h"
#include "Globals.h"

Matrix::Matrix() {
	write(0x09, 0x00); //decoding  BCD
	write(0x0a, 0x03); //brightness
	write(0x0b, 0x07); //scanlimit 8 LEDs
	write(0x0c, 0x01); //power-down mode 0 normal mode 1
	write(0x0f, 0x00); //test display 1 EOT display 0
}

void Matrix::initialize() {
	for (int i=1; i<9; i++) {
		write(i,0);
	}
}

void Matrix::writeByte (unsigned char data) {
		digitalWrite(MatrixCS, LOW);
		for (int i = 8; i >= 1; i--) {
			digitalWrite(MatrixCLK, LOW);
			digitalWrite(MatrixDIN, data & 0x80); // Extracting a bit data
			data = data << 1;
			digitalWrite(MatrixCLK, HIGH);
		}
	}

void Matrix::write (unsigned char address, unsigned char data) {
		digitalWrite(MatrixCS, LOW);
		writeByte(address); //addres code of LED
		writeByte(data); //data figure on LED
		digitalWrite(MatrixCS, HIGH);
	}

unsigned char disp1[38][8] = {
				{ 0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42,	0x3C }, //0
				{ 0x10, 0x18, 0x14, 0x10, 0x10, 0x10, 0x10, 0x10 }, //1
				{ 0x7E, 0x2, 0x2, 0x7E, 0x40, 0x40, 0x40, 0x7E }, //2
				{ 0x3E, 0x2, 0x2, 0x3E, 0x2, 0x2, 0x3E, 0x0 }, //3
				{ 0x8, 0x18, 0x28, 0x48, 0xFE, 0x8, 0x8, 0x8 }, //4
				{ 0x3C, 0x20, 0x20, 0x3C, 0x4, 0x4, 0x3C, 0x0 }, //5
				{ 0x3C, 0x20, 0x20, 0x3C, 0x24, 0x24, 0x3C, 0x0 }, //6
				{ 0x3E, 0x22, 0x4, 0x8, 0x8, 0x8, 0x8, 0x8 }, //7
				{ 0x0, 0x3E, 0x22, 0x22, 0x3E, 0x22, 0x22, 0x3E }, //8
				{ 0x3E, 0x22, 0x22, 0x3E, 0x2, 0x2, 0x2, 0x3E }, //9
				{ 0x8, 0x14, 0x22, 0x3E, 0x22, 0x22, 0x22, 0x22 }, //A
				{ 0x3C, 0x22, 0x22, 0x3E, 0x22, 0x22, 0x3C, 0x0 }, //B
				{ 0x3C, 0x40, 0x40, 0x40, 0x40, 0x40, 0x3C, 0x0 }, //C
				{ 0x7C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x7C, 0x0 }, //D
				{ 0x7C, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x7C }, //E
				{ 0x7C, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x40 }, //F
				{ 0x3C, 0x40, 0x40, 0x40, 0x40, 0x44, 0x44, 0x3C }, //G
				{ 0x44, 0x44, 0x44, 0x7C, 0x44, 0x44, 0x44, 0x44 }, //H
				{ 0x7C, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x7C }, //I
				{ 0x3C, 0x8, 0x8, 0x8, 0x8, 0x8, 0x48, 0x30 }, //J
				{ 0x0, 0x24, 0x28, 0x30, 0x20, 0x30, 0x28, 0x24 }, //K
				{ 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7C }, //L
				{ 0x81, 0xC3, 0xA5, 0x99, 0x81, 0x81, 0x81, 0x81 }, //M
				{ 0x0, 0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x0 }, //N
				{ 0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C }, //O
				{ 0x3C, 0x22, 0x22, 0x22, 0x3C, 0x20, 0x20, 0x20 }, //P
				{ 0x1C, 0x22, 0x22, 0x22, 0x22, 0x26, 0x22, 0x1D }, //Q
				{ 0x3C, 0x22, 0x22, 0x22, 0x3C, 0x24, 0x22, 0x21 }, //R
				{ 0x0, 0x1E, 0x20, 0x20, 0x3E, 0x2, 0x2, 0x3C }, //S
				{ 0x0, 0x3E, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8 }, //T
				{ 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x22, 0x1C }, //U
				{ 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x24, 0x18 }, //V
				{ 0x0, 0x49, 0x49, 0x49, 0x49, 0x2A, 0x1C, 0x0 }, //W
				{ 0x0, 0x41, 0x22, 0x14, 0x8, 0x14, 0x22, 0x41 }, //X
				{ 0x41, 0x22, 0x14, 0x8, 0x8, 0x8, 0x8, 0x8 }, //Y
				{ 0x0, 0x7F, 0x2, 0x4, 0x8, 0x10, 0x20, 0x7F }, //Z
				};

unsigned char Lollo [7][8] = {{disp1[21][0],disp1[21][1],disp1[21][2],disp1[21][3],disp1[21][4],disp1[21][5],disp1[21][6],disp1[21][7]},
		{disp1[24][0],disp1[24][1],disp1[24][2],disp1[24][3],disp1[24][4],disp1[24][5],disp1[24][6],disp1[24][7]},
		{disp1[27][0],disp1[27][1],disp1[27][2],disp1[27][3],disp1[27][4],disp1[27][5],disp1[27][6],disp1[27][7]},
		{disp1[10][0],disp1[10][1],disp1[10][2],disp1[10][3],disp1[10][4],disp1[10][5],disp1[10][6],disp1[10][7]},
		{disp1[18][0],disp1[18][1],disp1[18][2],disp1[18][3],disp1[18][4],disp1[18][5],disp1[18][6],disp1[18][7]},
		{disp1[23][0],disp1[23][1],disp1[23][2],disp1[23][3],disp1[23][4],disp1[23][5],disp1[23][6],disp1[23][7]},
		{disp1[14][0],disp1[14][1],disp1[14][2],disp1[14][3],disp1[14][4],disp1[14][5],disp1[14][6],disp1[14][7]}};

/*
	for (int j = 0; j < 7; j++) {
		for (int i = 1; i < 9; i++) {
			matrix->write(i, Matrix::Lollo[j][i - 1]);
			delay(100);
		}
		delay(800);
	}
	delay(1000);
*/

